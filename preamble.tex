% Common packages and configuration for the KU thesis template
\PassOptionsToPackage{table}{xcolor}
\usepackage{xcolor}
\usepackage{KUstyle}
\usepackage[margin=0.8in]{geometry}
\usepackage{fontspec}
\usepackage[english,danish]{babel}
\usepackage{setspace}
\usepackage{tabularx}
\usepackage{amsmath}
\usepackage{siunitx}
\usepackage{mdframed}
\usepackage{fvextra}
\usepackage{float}
\usepackage{booktabs} % Consistent table rules for evidence tables.
\usepackage{csquotes}

% Package decisions:
% - siunitx: used for numeric examples/units.
% - longtable: add only if a table must span multiple pages.

% Label conventions:
% sec:, subsec:, fig:, tab:, eq:, app:

% Main font configuration
\setmainfont{Arial}

% Reduce aggressive hyphenation to avoid hard word breaks in output.
\hyphenpenalty=800
\exhyphenpenalty=800
\emergencystretch=2em

% Numeric and unit formatting (Danish decimal comma).
\sisetup{
  output-decimal-marker = {,},
  group-separator = {.},
  group-minimum-digits = 4
}

% Table/figure source and note helpers (use below floats).
\newcommand{\TableSource}[1]{\par{\small\textit{Kilde: #1}}}
\newcommand{\TableNote}[1]{\par{\small\textit{Note: #1}}}
\newcommand{\FigureSource}[1]{\par{\small\textit{Kilde: #1}}}

% Table standard: caption above (label after caption), booktabs rules, source/note below tabular.
% Figure standard: PDF/PNG preferred, 300 dpi for raster, caption+label, source below.

% Bibliography setup
\usepackage[backend=biber,style=authoryear,maxcitenames=2,giveninits=true,uniquename=init]{biblatex}
\addbibresource{references.bib}

% Short-form parenthetical citations for selected institutional authors.
\DeclareCiteCommand{\parenciteshort}
  {\bibopenparen\usebibmacro{prenote}}
  {\ifnameundef{shortauthor}{\printnames{labelname}}{\printnames{shortauthor}}%
   \setunit{\nameyeardelim}%
   \printlabeldate}
  {\multicitedelim}
  {\usebibmacro{postnote}\bibcloseparen}

% Full-name narrative citations for institutional sources with shortauthor.
\DeclareCiteCommand{\textcitefull}
  {\usebibmacro{prenote}}
  {\printnames{author}\setunit{\nameyeardelim}\printtext[parens]{\printlabeldate}}
  {\multicitedelim}
  {\usebibmacro{postnote}}

% Customisation of default names
\renewcommand{\contentsname}{Indholdsfortegnelse}

% Approximate raw text count (chars incl. spaces) for chapters 02-10.
% Excludes tables/figures, citations, references, and front/back matter.
\newcommand{\RawCharCount}{0}
\newcommand{\RawPageCount}{0}
\newcommand{\RawCountSummary}{\RawCharCount\ tegn (ca.\ \RawPageCount\ sider)}
\AtBeginDocument{%
  \ifdefined\directlua
    \directlua{dofile("rawcount.lua")}
  \else
    \typeout{RAW_COUNT: LuaTeX not available (use LuaLaTeX to enable).}
  \fi
}


% Legal reference helpers.
\newcommand{\lawpar}[1]{\S~#1}
\newcommand{\lawart}[1]{art.~#1}

% Quote styling: make display quotes visually distinct and attributable.
\newmdenv[
  leftline=true,
  rightline=false,
  topline=false,
  bottomline=false,
  linecolor=KUrod,
  linewidth=2pt,
  backgroundcolor=black!5,
  skipabove=\baselineskip,
  skipbelow=\baselineskip,
  innerleftmargin=0.8em,
  innerrightmargin=0.8em,
  innertopmargin=0.6em,
  innerbottommargin=0.6em
]{quoteblock}

\newcommand{\quoteattrib}[1]{\par\hfill--- \normalfont #1}

\renewenvironment{displayquote}{\begin{quoteblock}\small\itshape}{\end{quoteblock}}
