\ProvidesPackage{KUstyle}

\RequirePackage{eso-pic}
\RequirePackage{graphicx}
\RequirePackage[absolute]{textpos}
\RequirePackage{hyperref}

\definecolor{KUrod}{RGB}{144,26,30}

\newif\ifKU@backgroundfileok
\newif\ifKU@brandfileok
\newread\KU@logoread
\def\KU@backgroundfile{sund-logo.pdf}
\def\KU@brandfile{sund-danish.pdf}
\def\KU@lfspointer{version https://git-lfs.github.com/spec/v1}

\newcommand*{\KU@checkbackgroundfile}{%
    \KU@backgroundfileokfalse
    \IfFileExists{\KU@backgroundfile}{%
        \begingroup
        \endlinechar=-1
        \openin\KU@logoread=\KU@backgroundfile
        \read\KU@logoread to \KU@logofirstline
        \closein\KU@logoread
        \ifx\KU@logofirstline\KU@lfspointer
            \global\KU@backgroundfileokfalse
        \else
            \global\KU@backgroundfileoktrue
        \fi
        \endgroup
        \ifKU@backgroundfileok\else
            \PackageWarning{KUstyle}{sund-logo.pdf is a Git LFS pointer. Replace it with the actual PDF to enable the cover background}%
        \fi
    }{%
        \PackageWarning{KUstyle}{sund-logo.pdf not found. Cover background omitted}%
    }%
}

\newcommand*{\KU@checkbrandfile}{%
    \KU@brandfileokfalse
    \IfFileExists{\KU@brandfile}{%
        \begingroup
        \endlinechar=-1
        \openin\KU@logoread=\KU@brandfile
        \read\KU@logoread to \KU@logofirstline
        \closein\KU@logoread
        \ifx\KU@logofirstline\KU@lfspointer
            \global\KU@brandfileokfalse
        \else
            \global\KU@brandfileoktrue
        \fi
        \endgroup
        \ifKU@brandfileok\else
            \PackageWarning{KUstyle}{sund-danish.pdf is a Git LFS pointer. Replace it with the actual PDF to enable the cover logo}%
        \fi
    }{%
        \PackageWarning{KUstyle}{sund-danish.pdf not found. Cover logo omitted}%
    }%
}

\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    linkcolor=black,
    urlcolor=black
}

\newcommand*{\advisor}[1]{\def\@advisor{#1}}
\newcommand*{\ptype}[1]{\def\@ptype{#1}}
\newcommand*{\subtitle}[1]{\def\@subtitle{#1}}
\newcommand*{\fpimage}[1]{\def\@fpimage{#1}}

\def\maketitle{
    \thispagestyle{empty}
    \KU@checkbackgroundfile
    \KU@checkbrandfile
    \ifKU@backgroundfileok
        \AddToShipoutPictureBG*{\includegraphics[width=\paperwidth,height=\paperheight]{\KU@backgroundfile}}
    \fi
    \ifKU@brandfileok
        \AddToShipoutPictureBG*{\includegraphics[width=\paperwidth,height=\paperheight]{\KU@brandfile}}
    \fi
    \ 
    
    \ifdefined\@fpimage
        \begin{textblock}{10}(1.5,4.7)
        \ifx\@fpimage\KU@backgroundfile
            \ifKU@backgroundfileok
                \noindent\includegraphics*[width=\textwidth, height=80mm, keepaspectratio]{\@fpimage}
            \else
                \PackageWarning{KUstyle}{Frontpage image omitted because sund-logo.pdf is not a valid PDF}%
            \fi
        \else
            \IfFileExists{\@fpimage}{%
                \noindent\includegraphics*[width=\textwidth, height=80mm, keepaspectratio]{\@fpimage}%
            }{%
                \PackageWarning{KUstyle}{Frontpage image file not found. Image omitted}%
            }%
        \fi
        \end{textblock}
    \fi
    
    \begin{textblock}{10}(1.5,10.4) \noindent\fontsize{20}{20}\selectfont \textbf{\@ptype}
    \end{textblock}
    
    \ifdefined\@subtitle
        \begin{textblock}{10}(1.5,11.0) \noindent\fontsize{14}{14}\selectfont \@author
        \end{textblock}
    \fi

    \ifdefined\@ptype
        \begin{textblock}{10}(1.5,11.9)
        \noindent\fontsize{20}{20}\selectfont \textbf{\@title}
        \end{textblock}
    \fi
    
    \begin{textblock}{10}(1.5,12.5)
        \noindent\fontsize{14}{14}\selectfont \@subtitle
    \end{textblock}
    
    \begin{textblock}{10}(1.5,13.7)
    \noindent\fontsize{11}{11}\selectfont \@date 
    \end{textblock}
    
    \ifdefined\@advisor
        \begin{textblock}{10}(1.5,14.2)
        \noindent\fontsize{11}{11}\selectfont \@advisor 
        \end{textblock}
    \fi
    
    \newpage
    \noindent
}
